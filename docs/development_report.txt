Отчет о разработке LumeLines: Daily Blocks

Дата: 2025-12-31

1) Цели и ограничения
- Проект спроектирован как офлайн-игра без серверов и регулярного контента.
- Монетизация только через CrazyGames SDK (midgame + rewarded).
- Игра полностью играбельна без рекламы (adblock/unfilled/error).

2) Технический стек
- TypeScript + Vite для сборки и dev-режима.
- Рендер: Canvas2D (без тяжелых движков) для максимальной простоты.
- Тесты: Vitest для core logic.
- Логи: структурированные INFO/WARN/ERROR, расширенные DEBUG в dev-режиме.

3) Архитектура проекта
- src/core: чистая игровая логика (board, scoring, combo, generator, cooldowns, daily, rng, game).
- src/app: UI, экранные состояния, рендер, ввод, сценарии запуска/паузы/результатов.
- src/services: интеграция CrazyGames SDK и слой сохранений.
- tests: юнит-тесты core logic.
- promo: метаданные и скриншоты для загрузки на CrazyGames.

4) Игровая механика (реализовано)
- Поле 10x10.
- Очки за размещение: +5 за клетку.
- Очистка линии: +120 за линию.
- Бонус мульти-очистки: +80*(L-1) за ход.
- Комбо: x1.00 старт, +0.25 за ход с очисткой, максимум x2.50. Без очистки — сброс в x1.00.
- Комбо влияет только на очки очистки.
- Tokens: max(1, floor(score/1500)).
- Бонусы Tokens: +2 за новый best score, +3 за первую попытку Daily в день.
- Темы: 20/35/50/70 Tokens.
- Rewarded Continue: 1 раз за раунд, score >= 800, новые фигуры [1x1, 1x2, 2x2], комбо сброс.
- Rewarded Double Tokens: 1 раз за раунд, tokens >= 2, затем tokens *= 2.
- Кулдаун rewarded: 90 секунд между любыми запросами.
- Кулдаун Continue: 10 минут между раундами (rewardCooldownUntil).
- AdError/adblock: награда не выдаётся, сообщение "Ad unavailable", игра не блокируется.

5) Генератор фигур
- Набор из 16 базовых фигур.
- На первых 10 ходах гарантируется хотя бы 1 доступная фигура.
- Исключены три крупных фигуры подряд (крупная = size >= 5).
- Daily-режим детерминированный (seed = YYYYMMDD + lumelines_v1).

6) UI/UX и управление
- Экраны: Loading, Main Menu, Gameplay, Pause, Results, Themes, Settings.
- Управление: drag-and-drop, на мобильных доступен tap-to-place.
- HUD: score, combo, tokens.
- Визуальная тема "Lume" через glow-эффекты на Canvas2D.

7) Интеграция CrazyGames SDK
- loadingStart/loadingStop при загрузке.
- gameplayStart/gameplayStop при входе/выходе из реального геймплея.
- requestAd("midgame"|"rewarded") с корректными callbacks.
- hasAdblock() с мягким уведомлением.
- happytime() на супер-комбо/новый рекорд.
Подробная карта вызовов: SDK_INTEGRATION.md.

8) Сохранения
- Используется CrazyGames Data module при наличии, иначе localStorage.
- Ключи: bestScore, themesUnlocked, dailyBest_YYYYMMDD, rewardCooldownUntil,
  runsCount, settings, tokens.

9) Тесты
- 28 тестов в Vitest.
- Покрытие: canPlace, applyPlacement/clear, scoring, combo, генератор,
  deterministic daily seed, cooldown rules.
- Результат: npm run test — успешно.

10) Сборка
- npm run build — успешно.
- Артефакты сборки в dist/.

11) Промо-материалы
- promo/metadata.json — title/description/tags.
- promo/screenshots/shot-1.png ... shot-6.png (1280x720).
- promo/promo-images/cover.svg + thumb.svg (placeholder).

12) Документация
- README.md: запуск, билд, SDK mock, список файлов для загрузки.
- ADR-001: обоснование выбора Canvas2D и архитектуры.
- CHECKLIST.md: QA чек-лист.
- DEVLOG.md: журнал прогресса.

13) Что сделано
- Полная реализация игры, UI, логики, сохранений, SDK-обертки.
- Скриншоты приведены к 1280x720 и переименованы.
- Подключен CrazyGames SDK скрипт в index.html.
- Тесты и сборка проходят локально.

14) Что осталось
- Смоук-тест на реальном CrazyGames SDK в окружении платформы.
- Замена placeholder cover/thumb при необходимости.

15) Риски и долги
- Возможные отличия поведения SDK на проде.
- Проверка drag-and-drop на разных мобильных браузерах.

Конец отчета.
